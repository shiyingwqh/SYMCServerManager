<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.0.0/css/xterm.css">
</head>
<body>
    <input id="id">
    <button onclick="cli()">Connect</button>
    <div id="xterm"></div>
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.0.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-attach@0.7.0/lib/xterm-addon-attach.js"></script>
    <script>
        function cli() {
            var id = document.getElementById("id").value
            conTerm(id)
        }
        var socket
        var term = new Terminal({
            rendererType: "canvas",
            rows: parseInt(24),
            convertEol: true,
            scrollback: 20,
            disableStdin: false,
            cursorStyle: "underline",
            cursorBlink: true,
            theme: {
                foreground: "yellow", //字体
                background: "#060101", //背景色
                cursor: "help" //设置光标
            }
        });
        // const attachAddon = new AttachAddon(socket);
        // term.loadAddon(attachAddon);
        var command = ''
        term.open(document.getElementById("xterm"));
        // 支持输入与粘贴方法
        term.onData(e => {
            switch (e) {
                case '\u0003': // Ctrl+C
                    term.write('^C');
                    prompt(term);
                    break;
                case '\r': // Enter
                    socket.send(command);
                    command = '';
                    break;
                case '\u007F': // Backspace (DEL)
                    // Do not delete the prompt
                    if (term._core.buffer.x > 0) {
                        term.write('\b \b');
                        if (command.length > 0) {
                            command = command.substr(0, command.length - 1);
                        }
                    }
                    break;
                default: // Print all other characters for demo
                    if (e >= String.fromCharCode(0x20) && e <= String.fromCharCode(0x7E) || e >= '\u00a0') {
                        command += e;
                        term.write(e);
                    }
            }
        });
        term.write('hello\n')
        function conTerm(id){
            socket = new WebSocket("ws://localhost:8080/socket/" + id)
            socket.onopen = function() {
                console.log("Socket 已打开");
            };
            socket.onmessage = function(msg) {
                console.log(msg);
                term.write(msg.data);
            };
            socket.onclose = function() {
                console.log("Socket已关闭");
            };
            //发生了错误事件
            socket.onerror = function() {
                alert("Socket发生了错误");
            }
        }

    </script>
</body>
</html>